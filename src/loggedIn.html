<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Welcome to Panduhz Financial Tracker</title>
  <link rel="stylesheet" href="loggedIn.css">
                                                                                                                                                    <script>
  window.REACT_APP_API_URL = 'http://localhost:7071/api';
  window.REACT_APP_UPLOAD_API_URL = 'http://localhost:7072/api';
  window.REACT_APP_ENVIRONMENT = 'development';
  window.REACT_APP_DEBUG = true;
</script>
</head>
<body>
  <div class="container">
    <div class="welcome-header">
      <h1 class="welcome-title">Welcome to Panduhz Financial Tracker</h1>
      <p class="welcome-subtitle">Your personal finance management hub</p>
    </div>
    
    <div class="user-info">
      <div class="user-avatar" id="userAvatar">üë§</div>
      <h2 class="user-name" id="userName">Loading...</h2>
      <p class="user-email" id="userEmail">Loading...</p>
    </div>
    
    <div class="action-buttons">
      <button class="btn" onclick="startFinancialTracking()">Start Tracking</button>
      <button class="btn btn-secondary" onclick="handleSignOut()">Sign Out</button>
    </div>
    
    
    <div class="features-preview">
      <h3 style="text-align: center; color: #333; margin-bottom: 20px;">Available Features</h3>
      <div class="feature-item clickable" onclick="goToAccounts()">
        <div class="feature-icon">üè¶</div>
        <div class="feature-text">Manage multiple bank accounts</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">üí∞</div>
        <div class="feature-text">Track income and expenses</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">üìä</div>
        <div class="feature-text">View spending analytics</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">üéØ</div>
        <div class="feature-text">Set and track financial goals</div>
      </div>
    </div>
  </div>

  <!-- Include the MSAL.js library -->
  <script src="https://alcdn.msauth.net/browser/2.32.0/js/msal-browser.min.js"></script>
  
  <!-- Include centralized configuration and utilities -->
  <script src="authService.js"></script>
  <script src="config.js"></script>
  <script src="utils.js"></script>
  <script src="auth.js"></script>

  <script>
    // Initialize when page loads
    window.onload = async function() {
      const authService = AuthService.getInstance();
      await authService.initialize();
      
      const currentUser = await authService.getCurrentUser();
      
      if (currentUser) {
        console.log('User Details:', currentUser);
        
        // Parse user name
        const nameParts = currentUser.name.split(' ');
        const firstName = nameParts[0] || 'User';
        const lastName = nameParts.slice(1).join(' ') || '';
        
        // Update the UI with user information
        updateUserInterface(firstName, lastName, currentUser.email, currentUser.id);
        
        // Log user information for debugging
        console.log('User logged in successfully!');
        console.log('First Name:', firstName);
        console.log('Last Name:', lastName);
        console.log('Email:', currentUser.email);
        console.log('User ID:', currentUser.id);
        
        // Load the financial overview chart
        setTimeout(() => {
          loadFinancialOverviewChart();
        }, 1000);
      } else {
        // If no account found, redirect to login
        window.location.replace('/index.html');
      }
    };

    function updateUserInterface(firstName, lastName, email, userId) {
      // Update user name
      const userNameElement = document.getElementById('userName');
      userNameElement.textContent = `Welcome, ${firstName} ${lastName}!`;
      
      // Update user email
      const userEmailElement = document.getElementById('userEmail');
      userEmailElement.textContent = email;
      
      // Update avatar with first letter of first name
      const userAvatarElement = document.getElementById('userAvatar');
      userAvatarElement.textContent = firstName.charAt(0).toUpperCase();
      
      // Store user information in localStorage for future use
    }

    function startFinancialTracking() {
      // Redirect to the financial tracking page
      window.location.href = window.getNavigationUrl('/dashboard', '/financialTracking.html');
    }

    function goToAccounts() {
      // Redirect to the accounts page
      window.location.href = window.getNavigationUrl('/accounts', '/accounts.html');
    }

    function handleSignOut() {
      // Call the signOut function from auth.js
      if (window.msalInstance) {
        window.msalInstance.logout();
        localStorage.clear();
        window.location.replace('/index.html');
      } else {
        // Fallback if signOut is not available
        localStorage.clear();
        window.location.replace('/index.html');
      }
    }
  </script>
</body>
</html>